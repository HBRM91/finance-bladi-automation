# .github/workflows/daily-automation.yml
name: Daily Finance Bladi Automation

on:
  # 1Ã¨re tentative : 8h UTC = 9h Maroc (aprÃ¨s publication BKAM)
  schedule:
    - cron: '0 7 * * 1-5'  # Lundi Ã  Vendredi Ã  07:00 UTC
  # DÃ©clenchement manuel depuis GitHub
  workflow_dispatch:
  # DÃ©clenchement par webhook
  repository_dispatch:
    types: [trigger_daily]

jobs:
  run-automation:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        cache: 'pip'
        
    - name: ğŸ“¦ Install dependencies
      run: |
        pip install -r requirements.txt
        pip install yfinance pandas requests gspread oauth2client
        
    - name: ğŸ”‘ Setup Google Sheets credentials
      run: |
        echo '${{ secrets.GOOGLE_SHEETS_CREDENTIALS }}' > credentials.json
        
    - name: ğŸš€ Run Finance Bladi Automation
      run: |
        echo "ğŸ• Starting automation at $(date)"
        python main.py
        echo "âœ… Automation completed at $(date)"
        
    - name: ğŸ’¾ Upload artifacts
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: finance-bladi-data-${{ github.run_id }}
        path: |
          data/
          logs/
        retention-days: 7
